<div id="popup-add-coupons" class="popup l-popup-page">
  <!-- 标题栏 -->
  <header class="bar bar-nav l-bar-nav">
    <a class="icon icon-left pull-left nav-back"></a>
    <a class="icon icon-refresh pull-right"></a>
    <h1 class="title">优惠券及套餐</h1>
  </header>
  <footer class="l-page-footer">
    <div class="_inner l-bg l-flex-hc">
      <a class="button button-big button-fill l-rest" onclick="addToOrder()">添加至订单</a>
    </div>
  </footer>
  <!-- 这里是页面内容区 -->
  <div class="content">
    <div class="buttons-tab l-sticky">
      <a href="#tab1" class="tab-link button active">可用优惠券</a>
      <a href="#tab2" class="tab-link button">可用套餐</a>
    </div>
    <div class="tabs">
      <div id="tab1" class="tab active">
        <div id="coupon-list" class="l-coupon-list">
          <div class="l-coupon-item l-link l-margin-b">
            <div class="_bd l-flex-hc">
              <div class="_val l-border-r l-text-wrap1"><i class="l-icon">&#xe6cb;</i><span>100.00</span></div>
              <div class="_desc l-rest">
                <h3 class="l-text-wrap1">代金券</h3>
                <p class="l-text-wrap2 l-fs-s">sfsads描述描述描述描述</p>
              </div>
            </div>
            <div class="_ft l-border-t l-text-gray">
              <span class="pull-right">剩余数量：9</span>
              <span>有效期：2017-05-10 </span>
            </div>
            <label class="l-check l-margin-l-s">
              <input type="checkbox" checked name="checkbox" value="1"><i></i>
            </label>
          </div>
          <div class="l-coupon-item l-link l-margin-b">
            <div class="_bd l-flex-hc">
              <div class="_val l-border-r l-text-wrap1"><i class="l-icon">&#xe6cb;</i><span>100.00</span></div>
              <div class="_desc l-rest">
                <h3 class="l-text-wrap1">代金券</h3>
                <p class="l-text-wrap2 l-fs-s">sfsads描述描述描述描述</p>
              </div>
            </div>
            <div class="_ft l-border-t l-text-gray">
              <span class="pull-right">剩余数量：9</span>
              <span>有效期：2017-05-10 </span>
            </div>
            <label class="l-check l-margin-l-s">
              <input type="checkbox" name="checkbox" value="2"><i></i>
            </label>
          </div>
        </div>
      </div>
      <div id="tab2" class="tab">
        <div id="combo-list" class="l-combo-list2">
          <div class="l-combo-item2">
            <div class="_hd">
              <span class="_tit">减免套餐</span>
            </div>
            <div class="_bd">
              <table class="l-table-1 l-fs-s">
                <thead class="l-text-nowrap">
                  <tr>
                    <th width="50">
                      <label class="l-check">
                        <input type="checkbox"><i class="_square"></i>
                      </label>
                    </th>
                    <th class="_tl">服务项目</th>
                    <th>剩余次数</th>
                    <th>单次抵扣</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <label class="l-check">
                        <input type="checkbox" value="1"><i class="_square"></i>
                      </label>
                    </td>
                    <td class="_tl">美容汽车</td>
                    <td>65</td>
                    <td>100.00</td>
                  </tr>
                  <tr>
                    <td>
                      <label class="l-check">
                        <input type="checkbox" value="2"><i class="_square"></i>
                      </label>
                    </td>
                    <td class="_tl">美容汽车</td>
                    <td>65</td>
                    <td>100.00</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="_ft l-border-t l-padding l-fs-s l-text-gray"><span>有效期至：2017-09-15</span></div>
          </div>
          <div class="l-combo-item2">
            <div class="_hd">
              <span class="_tit">减免套餐</span>
            </div>
            <div class="_bd">
              <table class="l-table-1 l-fs-s">
                <thead class="l-text-nowrap">
                  <tr>
                    <th width="50">
                      <label class="l-check">
                        <input type="checkbox"><i class="_square"></i>
                      </label>
                    </th>
                    <th class="_tl">服务项目</th>
                    <th>剩余次数</th>
                    <th>单次抵扣</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <label class="l-check">
                        <input type="checkbox" value="3"><i class="_square"></i>
                      </label>
                    </td>
                    <td class="_tl">美容汽车</td>
                    <td>65</td>
                    <td>100.00</td>
                  </tr>
                  <tr>
                    <td>
                      <label class="l-check">
                        <input type="checkbox" value="4"><i class="_square"></i>
                      </label>
                    </td>
                    <td class="_tl">美容汽车</td>
                    <td>65</td>
                    <td>100.00</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="_ft l-border-t l-padding l-fs-s l-text-gray"><span>有效期至：2017-09-15</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function addToOrder(){
      

      // 选择的优惠券
      var couponSlted = [];
      $('#coupon-list').find('input:checked').each(function(){
        couponSlted.push(this.value);
      });
      console.log('优惠券选择：', couponSlted);

      // 选择的套餐
      var comboSlted = [];
      $('#combo-list').find('tbody input:checked').each(function(){
        comboSlted.push(this.value);
      });
      console.log('套餐选择：', comboSlted);

      $.closeModal('#popup-add-coupons');
    }

    // 全选
    $('#combo-list').on('change', 'thead .l-check>input', function(){
      var checked = this.checked;
      $(this).closest('table').find('tbody .l-check>input').each(function(){
        this.checked = checked;
      });
    });
    $('#combo-list').on('change', 'tbody .l-check>input', function(){
      var checked = this.checked;
      if(!checked){
        $(this).closest('table').find('thead .l-check>input')[0].checked = false;
      }
    });
  </script>
</div>